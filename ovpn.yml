groups:
- name: OpenVPN
  rules:
  - alert: auto_backup_timer_Down
    expr: node_systemd_unit_state{instance="localhost:9100",job="node",name="auto-backup.timer",state="inactive",type="oneshot"} == 1
    for: 1m
    annotations:
      title: '"ovpn-up" timer is down'
      description: '"ovpn-up" timer has been down for more than 1 minute'
    labels:
      severity: 'critical'
  - alert: ovpn_up_timer_Down
    expr: node_systemd_unit_state{instance="localhost:9100",job="node",name="ovpn-up.timer",state="inactive",type="oneshot"} == 1
    for: 1m
    annotations:
      title: '"ovpn-up" timer is down'
      description: '"ovpn-up" timer has been down for more than 1 minute'
    labels:
      severity: 'critical'
  - alert: OpenVPN_Down
    expr: node_systemd_unit_state{instance="localhost:9100",job="node",name="openvpn-server@server-exam.service",state="inactive",type="notify"} == 1
    #expr: node_systemd_unit_state{instance="localhost:9100",job="node",name="ovpn-up-switch.service",state="inactive",type="oneshot"} == 1
    for: 1m
    annotations:
      title: 'OpenVPN server is down'
      description: 'OpenVPN server has been down for more than 1 minute'
    labels:
      severity: 'critical'
  - alert: CPU_Overload
    expr: node_load5 > CPUPLACEHOLDER
    for: 1m
    annotations:
      title: 'CPU is overloaded'
      description: 'CPU load for 5 minutes is over 100% for more than 1 minute'
    labels:
      severity: 'medium'
  - alert: LowMemory
    expr: 100 * (1 - (node_memory_MemFree_bytes + node_memory_Cached_bytes + node_memory_Buffers_bytes) / node_memory_MemTotal_bytes) > 85
    for: 5m
    annotations:
      title: 'Low RAM is available'
      description: 'Average available amoount of RAM is less than 15% for more than 5 minutes'
    labels:
      severity: 'critical'
  - alert: LowDiskSpace
    expr: 100 - node_filesystem_avail_bytes{fstype!="rootfs", mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"} * 100 > 90
    for: 1m
    annotations:
      title: 'Low disk space'
      description: 'Less than 10% of the disk space is available for more than 1 minute'
    labels:
      severity: 'critical' 

